apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-provisioning
  namespace: monitoring
data:
  dashboards.yaml: |
    apiVersion: 1
    providers:
    - name: 'default'
      orgId: 1
      folder: ''
      type: file
      disableDeletion: false
      updateIntervalSeconds: 10
      allowUiUpdates: true
      options:
        path: /etc/grafana/provisioning/dashboards
        foldersFromFilesStructure: true

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
  namespace: monitoring
data:
  elasticsearch-access-dashboard.json: |
    {
      "dashboard": {
        "id": null,
        "title": "Kubernetes Access Monitoring - Elasticsearch",
        "tags": ["kubernetes", "security", "access-control"],
        "timezone": "browser",
        "panels": [
          {
            "id": 1,
            "title": "Users with Access Overview",
            "type": "table",
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
            "targets": [
              {
                "refId": "A",
                "query": {
                  "bool": {
                    "must": [{"exists": {"field": "username"}}]
                  }
                },
                "timeField": "@timestamp"
              }
            ]
          },
          {
            "id": 2,
            "title": "Access Timeline",
            "type": "graph",
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
            "targets": [
              {
                "refId": "A",
                "query": {
                  "bool": {
                    "must": [{"exists": {"field": "@timestamp"}}]
                  }
                },
                "timeField": "@timestamp"
              }
            ]
          }
        ],
        "time": {"from": "now-24h", "to": "now"},
        "refresh": "5m",
        "schemaVersion": 27,
        "version": 0
      }
    }
  prometheus-security-dashboard.json: |
    {
      "dashboard": {
        "id": null,
        "title": "Kubernetes Security Monitoring - Prometheus",
        "tags": ["kubernetes", "security", "prometheus"],
        "timezone": "browser",
        "panels": [
          {
            "id": 1,
            "title": "Users with Sensitive Namespace Access",
            "type": "table",
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
            "targets": [
              {
                "expr": "k8s_namespace_sensitive_access_users_count",
                "refId": "A"
              }
            ]
          },
          {
            "id": 2,
            "title": "Cluster-wide Sensitive Access",
            "type": "table",
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
            "targets": [
              {
                "expr": "k8s_cluster_wide_sensitive_access_users_count",
                "refId": "A"
              }
            ]
          }
        ],
        "time": {"from": "now-1h", "to": "now"},
        "refresh": "30s",
        "schemaVersion": 27,
        "version": 0
      }
    }

